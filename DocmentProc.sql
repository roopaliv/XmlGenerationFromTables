

GO
/****** Object:  StoredProcedure [opera].[sp_ivp_polaris_generate_opera_xml]    Script Date: 05/27/2013 15:49:51 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER  PROCEDURE [opera].[sp_ivp_polaris_upload_documents] 
(
@Document VARBINARY(MAX),
@FileName VARCHAR(1000),
@MimeType VARCHAR(500) = 'application/octetstream',
@ReportID INT,
@FundID INT,
@ReportingDate DATETIME,
@SectionId INT,
@SubSectionId INT = NULL,
@UserName VARCHAR(200)
)
/****** 
StoredProcedure [opera].[sp_ivp_polaris_uplaod_documents]  03 June 2013 Roopali

exec opera.sp_ivp_polaris_upload_documents @ReportID='33',@FundID='21',@SubSectionId='1',@SectionId='1',@Document=0x3C726164477269643A524144477269642049443D227B53797374656D2E586D6C2E586D6C457863657074696F6E3A20526F6F7420656C656D656E74206973206D697373696E672E0D0A20202061742053797374656D2E586D6C2E586D6C54657874526561646572496D706C2E5468726F7728457863657074696F6E2065290D0A20202061742053797374656D2E586D6C2E586D6C54657874526561646572496D706C2E5061727365446F63756D656E74436F6E74656E7428290D0A20202061742053797374656D2E586D6C2E586D6C54657874526561646572496D706C2E5265616428290D0A20202061742053797374656D2E586D6C2E4C696E712E58446F63756D656E742E4C6F616428586D6C526561646572207265616465722C204C6F61644F7074696F6E73206F7074696F6E73290D0A20202061742053797374656D2E586D6C2E4C696E712E58446F63756D656E742E4C6F6164285465787452656164657220746578745265616465722C204C6F61644F7074696F6E73206F7074696F6E73290D0A202020617420636F6D2E6976702E7261642E636F6E74726F6C732E786C677269642E524144584C477269642E47657453657269616C697A656444617461536F7572636528290D0A202020617420636F6D2E6976702E7261642E636F6E74726F6C732E786C677269642E524144584C477269642E4461746142696E6428290D0A202020617420506F6C617269732E5765622E436F6E74726F6C732E526164586C477269644C6F616465722E4461746142696E6428290D0A202020617420636F6D2E6976702E706F6C617269732E636F72652E6D6F64756C652E557365724D616E6167656D656E742E47726F75704D616E6167656D656E742E476574557365727328290D0A202020617420636F6D2E6976702E706F6C617269732E636F72652E6D6F64756C652E557365724D616E6167656D656E742E47726F75704D616E6167656D656E742E506167654C6F61644576656E74284F626A6563742073656E6465722C204576656E74417267732065297D222072756E61743D2273657276657222204175746F47656E6572617465436F6C756D6E733D2246616C7365222053656C6563746564526F775374796C652D486F72697A6F6E74616C416C69676E3D2243656E746572220D0A20202020202020202020202020202020202020202020202020202020202020202020202053656C6563746564526F775374796C652D566572746963616C416C69676E3D224D6964646C65222052657175697265436C69656E745369646546756E6374696F6E616C6974793D2274727565220D0A202020202020202020202020202020202020202020202020202020202020202020202020536B696E49443D226772696457697468436C69656E745369646546756E6374696F6E616C69747922205265717569726546697865644865616465723D22547275652220436F6E7461696E65724865696768743D223330307078220D0A2020202020202020202020202020202020202020202020202020202020202020202020205265717569726555707065724865616465723D22747275652220436C656172526F77436C69636B496E666F3D2246616C73652220436C69656E744D61785061676553697A653D223130222052657175697265436C69656E745369646546696C7465723D2274727565220D0A20202020202020202020202020202020202020202020202020202020202020202020202052657175697265436C69656E7453696465506167696E673D2254727565222052657175697265436C69656E7453696465536F72743D22747275652220526571756972654578706F7274546F457863656C3D2246616C7365220D0A202020202020202020202020202020202020202020202020202020202020202020202020526571756972654D617374657244657461696C3D2246616C73652220526571756972654D617374657244657461696C457870616E6465643D2246616C73652220526571756972654D617468656D61746963616C4F7065726174696F6E733D2266616C7365220D0A202020202020202020202020202020202020202020202020202020202020202020202020526571756972655265636F726453756D6D6172793D2246616C736522205265717569726553656C656374696F6E436F756E743D2266616C73652220526571756972655374617475734261723D2254727565220D0A202020202020202020202020202020202020202020202020202020202020202020202020526571756972655465787442617365645365617263683D2274727565223E0D0A2020202020202020202020202020202020202020202020202020202020202020202020203C436F6C756D6E733E0D0A202020202020202020202020202020202020202020202020202020202020202020202020202020203C6173703A426F756E644669656C6420446174614669656C643D224C6F67696E4E616D652220486561646572546578743D225573657220496422204865616465725374796C652D486F72697A6F6E74616C416C69676E3D2243656E74657222202F3E0D0A2020202020202020202020202020202020202020202020202020202020202020202020203C2F436F6C756D6E733E0D0A2020202020202020202020202020202020202020202020202020202020202020202020203C456D7074794461746154656D706C6174653E0D0A202020202020202020202020202020202020202020202020202020202020202020202020202020203C6173703A4C6162656C2049443D226C626C4E6F446174612220546578743D224E6F205265636F72647320466F756E642220466F6E742D426F6C643D2274727565222072756E61743D22736572766572220D0A2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020466F7265436F6C6F723D22426C61636B223E0D0A202020202020202020202020202020202020202020202020202020202020202020202020202020203C2F6173703A4C6162656C3E0D0A2020202020202020202020202020202020202020202020202020202020202020202020203C2F456D7074794461746154656D706C6174653E0D0A20202020202020202020202020202020202020202020202020202020202020203C2F726164477269643A524144477269643E0D0A0D0A0D0A0D0A
,@FileName='radgrid groupmanagement.txt',@UserName='rvij',@ReportingDate='8/20/2012 00:00:00 AM'

 ******/
     
AS    
BEGIN
BEGIN TRY  

SET NOCOUNT ON; 
BEGIN TRAN TransactionOperaDocumentUpload



INSERT INTO [opera].[ivp_polaris_upload_documents]
           ([document],[file_name],[mime_type]
           ,[created_on],[created_by] ,[modified_on],[modified_by],[is_active])
     VALUES
           (@Document ,@FileName ,@MimeType
           ,GETDATE() ,@UserName ,GETDATE() ,@UserName,1)


DECLARE @InsertedDocumentID AS INT
SET @InsertedDocumentID = @@IDENTITY


INSERT INTO [opera].[ivp_polaris_document_Map]
           ([Document_id],[report_id],[fund_id],[reporting_date],[section_id],[sub_section_id]
           ,[created_on],[created_by] ,[modified_on],[modified_by] ,[is_active])
     VALUES
           (@InsertedDocumentID,@ReportID ,@FundID,@ReportingDate,@SectionId ,@SubSectionId
           ,GETDATE() ,@UserName ,GETDATE() ,@UserName,1)
           
COMMIT TRAN TransactionOperaDocumentUpload

END TRY

BEGIN CATCH
IF(@@TRANCOUNT > 0)
BEGIN
ROLLBACK TRAN TransactionOperaDocumentUpload
END
END CATCH
END





